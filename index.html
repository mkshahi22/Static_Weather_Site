<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shahi Weather App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #2ecc71;
            --accent-color: #f39c12;
            --text-light: #f5f5f5;
            --text-dark: #333;
            --background-light: rgba(255, 255, 255, 0.8);
            --background-dark: rgba(41, 47, 51, 0.85);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-image: url('https://images.unsplash.com/photo-1534088568595-a066f410bcda?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--text-dark);
            position: relative;
            transition: background-image 0.7s ease;
            overflow-x: hidden;
            /* Prevent horizontal overflow */
        }

        /* Animation classes */
        .theme-transition {
            animation: fadeTransition 1s ease;
        }

        .bg-transition {
            animation: fadeBackground 0.8s ease;
        }

        .weather-fade-in {
            animation: fadeIn 0.8s ease;
        }

        .aqi-fade-in {
            animation: slideUp 0.8s ease;
        }

        .temp-change {
            animation: pulse 0.5s ease;
        }

        .refresh-pulse {
            animation: refreshPulse 1s ease;
        }

        .error-shake {
            animation: shake 0.5s ease;
        }

        .converter-animation {
            animation: slideToggle 0.5s ease;
        }

        .icon-pulse {
            animation: pulse 2s infinite;
        }

        .forecast-item {
            animation: slideInRight 0.5s ease forwards;
            opacity: 0;
        }

        /* Keyframes */
        @keyframes fadeTransition {
            0% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes fadeBackground {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes refreshPulse {
            0% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.7;
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-5px);
            }

            40%,
            80% {
                transform: translateX(5px);
            }
        }

        @keyframes slideToggle {
            0% {
                max-height: 0;
            }

            100% {
                max-height: 200px;
            }
        }

        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translateX(20px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        body.dark-mode {
            color: var(--text-light);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
            /* Add space for toggle button on mobile */
            padding-top: 80px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .app-title {
            font-size: 2.5rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            opacity: 0.9;
        }

        .search-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--background-light);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
            transition: var(--transition);
            /* Prevent overflow */
            width: 100%;
            max-width: 100%;
        }

        body.dark-mode .search-container {
            background-color: var(--background-dark);
        }

        #cityInput {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            outline: none;
            transition: var(--transition);
            margin-right: 10px;
            min-width: 0;
            /* Allow input to shrink */
        }

        body.dark-mode #cityInput {
            background-color: #3a3a3a;
            color: var(--text-light);
        }

        #searchBtn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            white-space: nowrap;
            /* Prevent button text from wrapping */
            flex-shrink: 0;
            /* Prevent button from shrinking */
        }

        #searchBtn:hover {
            background-color: #3a78c2;
            transform: translateY(-2px);
        }

        .mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            box-shadow: var(--shadow);
            z-index: 1000;
            /* Higher z-index to prevent overlap */
            transition: var(--transition);
        }

        .mode-toggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        /* Ensure toggle button doesn't interfere with scrolling */
        .mode-toggle:active {
            transform: scale(0.95);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 40px 0;
            color: var(--text-light);
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            margin: 0 auto 15px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-container {
            display: none;
            background-color: rgba(231, 76, 60, 0.85);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .weather-container {
            display: none;
            background-color: var(--background-light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            width: 100%;
            max-width: 100%;
        }

        body.dark-mode .weather-container {
            background-color: var(--background-dark);
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        body.dark-mode .weather-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .location {
            font-size: 1.6rem;
            margin-bottom: 5px;
        }

        .date-time {
            color: #666;
        }

        body.dark-mode .date-time {
            color: #ccc;
        }

        .toggle-temp-unit {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .toggle-temp-unit:hover {
            background-color: #3a78c2;
        }

        .temp-converter-toggle {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            margin-left: 10px;
            transition: var(--transition);
            white-space: nowrap;
        }

        .temp-converter-toggle:hover {
            background-color: #e67e22;
        }

        .converter-container {
            background-color: var(--background-light);
            border-radius: var(--border-radius);
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 0;
            box-shadow: var(--shadow);
            width: 100%;
        }

        body.dark-mode .converter-container {
            background-color: var(--background-dark);
        }

        .converter-container.show-converter {
            padding: 15px;
            max-height: 200px;
            /* Increased for mobile */
            margin-bottom: 15px;
        }

        .converter-grid {
            display: grid;
            grid-template-columns: 1fr 50px 1fr;
            align-items: center;
            gap: 10px;
        }

        .converter-label {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .converter-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            width: 100%;
            font-size: 16px;
            /* Prevent zoom on iOS */
        }

        body.dark-mode .converter-input {
            background-color: #3a3a3a;
            color: var(--text-light);
            border-color: #555;
        }

        .converter-switch {
            text-align: center;
            font-size: 20px;
            color: var(--primary-color);
        }

        .weather-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 20px 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .temperature-container {
            display: flex;
            flex-direction: column;
        }

        .temperature {
            font-size: 4rem;
            font-weight: 300;
            position: relative;
        }

        .temp-unit {
            font-size: 2rem;
            position: absolute;
            top: 10px;
            margin-left: 5px;
        }

        #minMaxTemp {
            color: #666;
            margin-top: 5px;
        }

        body.dark-mode #minMaxTemp {
            color: #ccc;
        }

        .weather-icon {
            display: flex;
            align-items: center;
        }

        .weather-icon img {
            width: 100px;
            height: 100px;
        }

        .weather-description {
            text-align: center;
            font-size: 1.4rem;
            padding: 0 20px 20px;
            color: var(--primary-color);
            font-weight: bold;
        }

        .weather-details,
        .additional-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .weather-details,
        body.dark-mode .additional-details {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item {
            display: flex;
            align-items: center;
        }

        .detail-item i {
            font-size: 24px;
            color: var(--primary-color);
            margin-right: 15px;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .detail-item p:first-of-type {
            color: #666;
            margin-bottom: 3px;
            font-size: 0.9rem;
        }

        body.dark-mode .detail-item p:first-of-type {
            color: #ccc;
        }

        .detail-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .sunrise-sunset {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.03);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 20px;
        }

        body.dark-mode .sunrise-sunset {
            background-color: rgba(255, 255, 255, 0.03);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sun-item {
            text-align: center;
        }

        .sun-item i {
            font-size: 28px;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .sun-label {
            color: #666;
            margin-bottom: 3px;
        }

        body.dark-mode .sun-label {
            color: #ccc;
        }

        .sun-time {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .aqi-container {
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .aqi-container {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .aqi-title,
        .forecast-title {
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .aqi-title i,
        .forecast-title i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        .aqi-indicator {
            height: 8px;
            background: linear-gradient(to right, #57e32c, #ffff00, #ffa500, #ff0000, #800080);
            border-radius: 4px;
            margin: 15px 0;
            position: relative;
        }

        .aqi-marker {
            position: absolute;
            top: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #57e32c;
            transform: translateX(-50%);
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .aqi-value {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .aqi-description {
            color: #666;
        }

        body.dark-mode .aqi-description {
            color: #ccc;
        }

        .pollutants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .pollutant-item {
            background-color: rgba(0, 0, 0, 0.03);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        body.dark-mode .pollutant-item {
            background-color: rgba(255, 255, 255, 0.07);
        }

        .pollutant-item span {
            font-weight: bold;
            color: var(--primary-color);
        }

        .forecast-container {
            padding: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .forecast-container {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .forecast-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .forecast-item {
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            transition: var(--transition);
        }

        .forecast-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        body.dark-mode .forecast-item {
            background-color: rgba(255, 255, 255, 0.07);
        }

        .forecast-day {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .forecast-temp {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .forecast-details {
            display: flex;
            justify-content: space-around;
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }

        body.dark-mode .forecast-details {
            color: #ccc;
        }

        .forecast-details i {
            margin-right: 3px;
        }

        .update-info {
            padding: 15px 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .update-info {
            color: #ccc;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Tablet responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                padding-top: 80px;
                /* Maintain space for toggle */
            }

            .mode-toggle {
                top: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .weather-details,
            .additional-details {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .forecast-items {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }

            .temperature {
                font-size: 3.5rem;
            }

            .temp-unit {
                font-size: 1.7rem;
            }

            .app-title {
                font-size: 2rem;
            }

            .location {
                font-size: 1.4rem;
            }

            .weather-main {
                justify-content: center;
                text-align: center;
            }

            .pollutants-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
                padding-top: 70px;
                /* Adjusted for smaller mobile screens */
            }

            .mode-toggle {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .search-container {
                padding: 12px 15px;
                flex-direction: column;
                gap: 10px;
            }

            #cityInput {
                margin-right: 0;
                margin-bottom: 10px;
                width: 100%;
            }

            #searchBtn {
                width: 100%;
                padding: 12px;
            }

            .weather-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .toggle-temp-unit,
            .temp-converter-toggle {
                margin-top: 0;
                margin-left: 0;
                margin-right: 10px;
                font-size: 14px;
                padding: 6px 12px;
            }

            .weather-main {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .weather-details,
            .additional-details {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
            }

            .temperature {
                font-size: 3rem;
            }

            .temp-unit {
                font-size: 1.5rem;
            }

            .app-title {
                font-size: 1.8rem;
            }

            .app-subtitle {
                font-size: 1rem;
            }

            .location {
                font-size: 1.2rem;
            }

            .converter-container.show-converter {
                max-height: 250px;
                /* More space on mobile */
            }

            .converter-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .converter-switch {
                display: none;
            }

            .converter-input {
                font-size: 16px;
                /* Prevent zoom on iOS */
            }

            .forecast-items {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .forecast-item {
                padding: 10px;
            }

            .sunrise-sunset {
                padding: 15px;
                justify-content: space-between;
            }

            .pollutants-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .detail-item {
                align-items: flex-start;
            }

            .detail-item i {
                margin-top: 2px;
            }

            /* Ensure no horizontal overflow */
            .weather-container,
            .search-container,
            .converter-container {
                max-width: calc(100vw - 20px);
            }
        }

        /* Extra small screens */
        @media (max-width: 320px) {
            .container {
                padding: 8px;
                padding-top: 60px;
            }

            .mode-toggle {
                width: 30px;
                height: 30px;
                font-size: 14px;
                top: 8px;
                right: 8px;
            }

            .app-title {
                font-size: 1.5rem;
            }

            .temperature {
                font-size: 2.5rem;
            }

            .temp-unit {
                font-size: 1.2rem;
            }

            .forecast-items {
                grid-template-columns: 1fr;
            }

            .weather-details,
            .additional-details {
                padding: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="overlay" id="overlay"></div>

    <button class="mode-toggle" id="modeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container">
        <header>
            <h1 class="app-title">Shahi Weather App</h1>
            <p class="app-subtitle">Check weather conditions across the globe</p>
        </header>

        <div class="search-container">
            <input type="text" id="cityInput" placeholder="Enter city name...">
            <button id="searchBtn">Search</button>
        </div>

        <!-- Temperature Converter -->
        <div class="converter-container" id="converterContainer">
            <p class="converter-label">Temperature Converter</p>
            <div class="converter-grid">
                <div>
                    <label>Celsius (°C)</label>
                    <input type="number" class="converter-input" id="celsiusInput" placeholder="Enter temperature...">
                </div>
                <div class="converter-switch">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div>
                    <label>Fahrenheit (°F)</label>
                    <input type="number" class="converter-input" id="fahrenheitInput"
                        placeholder="Enter temperature...">
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="loader"></div>
            <p>Fetching weather data...</p>
        </div>

        <div class="error-container" id="errorContainer">
            <p id="errorMessage">City not found. Please try again.</p>
        </div>

        <div class="weather-container" id="weatherContainer">
            <div class="weather-header">
                <div>
                    <h2 class="location" id="location">New York, US</h2>
                    <p class="date-time" id="dateTime">Monday, 10:30 AM</p>
                </div>
                <button class="toggle-temp-unit" id="toggleTempUnit">
                    <i class="fas fa-temperature-high"></i> °C
                </button>
            </div>

            <div class="weather-main">
                <div class="temperature-container">
                    <span class="temperature" id="temperature">25<span class="temp-unit">°C</span></span>
                    <div id="minMaxTemp">Min: 20°C | Max: 28°C</div>
                </div>
                <div class="weather-icon" id="weatherIcon">
                    <img src="/api/placeholder/100/100" alt="Weather icon">
                </div>
            </div>

            <div class="weather-description" id="weatherDescription">Sunny</div>

            <div class="weather-details">
                <div class="detail-item">
                    <i class="fas fa-temperature-high"></i>
                    <div>
                        <p>Feels Like</p>
                        <p class="detail-value" id="feelsLike">27°C</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-tint"></i>
                    <div>
                        <p>Humidity</p>
                        <p class="detail-value" id="humidity">65%</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-wind"></i>
                    <div>
                        <p>Wind Speed</p>
                        <p class="detail-value" id="windSpeed">5.2 km/h</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-compass"></i>
                    <div>
                        <p>Wind Direction</p>
                        <p class="detail-value" id="windDirection">NE</p>
                    </div>
                </div>
            </div>

            <div class="additional-details">
                <div class="detail-item">
                    <i class="fas fa-compress-arrows-alt"></i>
                    <div>
                        <p>Pressure</p>
                        <p class="detail-value" id="pressure">1013 hPa</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-eye"></i>
                    <div>
                        <p>Visibility</p>
                        <p class="detail-value" id="visibility">10 km</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-cloud"></i>
                    <div>
                        <p>Cloudiness</p>
                        <p class="detail-value" id="cloudiness">10%</p>
                    </div>
                </div>
                <div class="detail-item">
                    <i class="fas fa-umbrella"></i>
                    <div>
                        <p>Precipitation</p>
                        <p class="detail-value" id="precipitation">0 mm</p>
                    </div>
                </div>
                <!-- New Dew Point Detail -->
                <div class="detail-item">
                    <i class="fas fa-water"></i>
                    <div>
                        <p>Dew Point</p>
                        <p class="detail-value" id="dewPoint">15°C</p>
                    </div>
                </div>
                <!-- New UV Index Detail -->
                <div class="detail-item">
                    <i class="fas fa-sun"></i>
                    <div>
                        <p>UV Index</p>
                        <p class="detail-value" id="uvIndex">5.2 (Moderate)</p>
                    </div>
                </div>
            </div>

            <div class="sunrise-sunset">
                <div class="sun-item">
                    <i class="fas fa-sunrise"></i>
                    <p class="sun-label">Sunrise</p>
                    <p class="sun-time" id="sunrise">06:45 AM</p>
                </div>
                <div class="sun-item">
                    <i class="fas fa-sunset"></i>
                    <p class="sun-label">Sunset</p>
                    <p class="sun-time" id="sunset">07:30 PM</p>
                </div>
            </div>

            <div class="aqi-container" id="aqiContainer">
                <h3 class="aqi-title"><i class="fas fa-lungs"></i> Air Quality</h3>
                <div class="aqi-indicator">
                    <div class="aqi-level"></div>
                    <div class="aqi-marker" id="aqiMarker" style="left: 20%;"></div>
                </div>
                <div class="aqi-value" id="aqiValue">AQI: 42 (Good)</div>
                <p class="aqi-description" id="aqiDescription">Air quality is satisfactory, and air pollution poses
                    little or no risk.</p>

                <!-- Added detailed pollutants -->
                <div class="pollutants-grid" id="pollutants">
                    <!-- Pollutant data will be inserted here -->
                </div>
            </div>

            <div class="forecast-container">
                <h3 class="forecast-title"><i class="fas fa-calendar-alt"></i> 5-Day Forecast</h3>
                <div class="forecast-items" id="forecastItems">
                    <!-- Forecast items will be inserted here -->
                </div>
            </div>

            <p class="update-info" id="lastUpdated">Last updated: Just now • Auto-refreshes in <span
                    id="refreshTimer">60</span>s</p>
        </div>
    </div>

    <script>
        const WEATHER_API_KEY = "7783e608ded704db25827fea9fb405ee";
        const WEATHER_BASE_URL = "https://api.openweathermap.org/data/2.5/weather";
        const FORECAST_URL = "https://api.openweathermap.org/data/2.5/forecast";
        const AQI_URL = "https://api.openweathermap.org/data/2.5/air_pollution";

        // DOM Elements
        const cityInput = document.getElementById("cityInput");
        const searchBtn = document.getElementById("searchBtn");
        const modeToggle = document.getElementById("modeToggle");
        const weatherContainer = document.getElementById("weatherContainer");
        const loading = document.getElementById("loading");
        const errorContainer = document.getElementById("errorContainer");
        const errorMessage = document.getElementById("errorMessage");
        const toggleTempUnit = document.getElementById("toggleTempUnit");
        const refreshTimer = document.getElementById("refreshTimer");
        const lastUpdated = document.getElementById("lastUpdated");
        const forecastItems = document.getElementById("forecastItems");
        const overlay = document.getElementById("overlay");

        // Weather Elements
        const location_elem = document.getElementById("location");
        const dateTime = document.getElementById("dateTime");
        const temperature = document.getElementById("temperature");
        const minMaxTemp = document.getElementById("minMaxTemp");
        const weatherIcon = document.getElementById("weatherIcon");
        const weatherDescription = document.getElementById("weatherDescription");
        const feelsLike = document.getElementById("feelsLike");
        const humidity = document.getElementById("humidity");
        const windSpeed = document.getElementById("windSpeed");
        const windDirection = document.getElementById("windDirection");
        const pressure = document.getElementById("pressure");
        const visibility = document.getElementById("visibility");
        const cloudiness = document.getElementById("cloudiness");
        const precipitation = document.getElementById("precipitation");
        const sunrise = document.getElementById("sunrise");
        const sunset = document.getElementById("sunset");
        const dewPoint = document.getElementById("dewPoint");
        const uvIndex = document.getElementById("uvIndex");
        const aqiValue = document.getElementById("aqiValue");
        const aqiMarker = document.getElementById("aqiMarker");
        const aqiDescription = document.getElementById("aqiDescription");
        const aqiContainer = document.getElementById("aqiContainer");

        // State variables
        let currentTempUnit = "metric"; // metric (celsius) or imperial (fahrenheit)
        let currentWeatherData = null;
        let updateInterval = null;
        let refreshCountdown = null;
        let countdown = 60;
        let isAutoRefreshActive = false;

        // AQI descriptions
        const aqiDescriptions = {
            1: { text: "Air quality is excellent. Perfect for outdoor activities.", color: "#57e32c" },
            2: { text: "Air quality is satisfactory, and air pollution poses little or no risk.", color: "#ffff00" },
            3: { text: "Air quality is acceptable; however, pollution may cause mild effects for sensitive individuals.", color: "#ffa500" },
            4: { text: "Health alert: Everyone may experience health effects; sensitive groups may experience more serious effects.", color: "#ff0000" },
            5: { text: "Health warning: The health risks are increased for everyone. Avoid outdoor activities.", color: "#800080" }
        };

        // Event Listeners
        searchBtn.addEventListener("click", getWeather);
        cityInput.addEventListener("keyup", (e) => {
            if (e.key === "Enter") {
                getWeather();
            }
        });
        modeToggle.addEventListener("click", toggleDarkMode);
        toggleTempUnit.addEventListener("click", toggleTemperatureUnit);

        // Check for saved dark mode preference
        if (localStorage.getItem("darkMode") === "enabled") {
            document.body.classList.add("dark-mode");
            modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Check for saved temperature unit preference
        if (localStorage.getItem("tempUnit")) {
            currentTempUnit = localStorage.getItem("tempUnit");
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                hour: '2-digit',
                minute: '2-digit'
            };
            dateTime.textContent = now.toLocaleDateString(undefined, options);
        }

        // Toggle dark/light mode
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");

            if (document.body.classList.contains("dark-mode")) {
                modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem("darkMode", "enabled");
            } else {
                modeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem("darkMode", "disabled");
            }

            // Add animation for mode toggle
            document.body.classList.add("theme-transition");
            setTimeout(() => {
                document.body.classList.remove("theme-transition");
            }, 1000);
        }

        // Toggle temperature unit (Celsius/Fahrenheit)
        function toggleTemperatureUnit() {
            if (currentTempUnit === "metric") {
                currentTempUnit = "imperial";
                toggleTempUnit.innerHTML = '<i class="fas fa-temperature-high"></i> °F';
            } else {
                currentTempUnit = "metric";
                toggleTempUnit.innerHTML = '<i class="fas fa-temperature-high"></i> °C';
            }

            localStorage.setItem("tempUnit", currentTempUnit);

            // Re-fetch weather data with new units instead of converting existing data
            if (currentWeatherData) {
                const city = cityInput.value.trim();
                if (city) {
                    getWeather();
                }
            }

            // Add animation for unit change
            temperature.classList.add("temp-change");
            setTimeout(() => {
                temperature.classList.remove("temp-change");
            }, 500);
        }

        // Get weather data
        async function getWeather() {
            const city = cityInput.value.trim();

            if (!city) return;

            showLoading();
            hideError();

            try {
                const url = `${WEATHER_BASE_URL}?q=${city}&appid=${WEATHER_API_KEY}&units=${currentTempUnit}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error("City not found or API error");
                }

                const data = await response.json();
                currentWeatherData = data;

                // Get additional data
                const [forecastData, aqiData, uvData] = await Promise.all([
                    getForecastData(data.coord.lat, data.coord.lon),
                    getAirQuality(data.coord.lat, data.coord.lon),
                    getUVIndex(data.coord.lat, data.coord.lon)
                ]);

                // Display all data
                displayWeather(data, uvData);
                displayForecast(forecastData);
                displayAirQuality(aqiData);

                // Set up auto-refresh with better mobile support
                setupAutoRefresh(data.coord.lat, data.coord.lon, city);

                // Set background based on weather
                setWeatherBackground(data.weather[0].icon);

                // Add animation for new weather data
                weatherContainer.classList.add("weather-fade-in");
                setTimeout(() => {
                    weatherContainer.classList.remove("weather-fade-in");
                }, 1000);
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }

        // Get UV Index data from latitude and longitude
        async function getUVIndex(lat, lon) {
            try {
                const uvUrl = `https://api.openweathermap.org/data/2.5/uvi?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}`;
                const response = await fetch(uvUrl);

                if (!response.ok) {
                    return null;
                }

                return await response.json();
            } catch (error) {
                console.error("Failed to fetch UV data:", error);
                return null;
            }
        }

        // Calculate dew point
        function calculateDewPoint(temp, humidity) {
            // Constants for Magnus formula
            const a = currentTempUnit === "metric" ? 17.27 : 17.625;
            const b = currentTempUnit === "metric" ? 237.7 : 243.04;

            // Calculate dew point using Magnus formula
            const alpha = ((a * temp) / (b + temp)) + Math.log(humidity / 100.0);
            const dewPoint = (b * alpha) / (a - alpha);

            return Math.round(dewPoint * 10) / 10; // Round to 1 decimal place
        }

        // Set background image based on weather condition
        function setWeatherBackground(iconCode) {
            // Weather backgrounds mapping (you need to have these images)
            const weatherBackgrounds = {
                "01d": "images/clear-day.jpg",
                "01n": "images/clear-night.jpg",
                "02d": "images/few-clouds-day.jpg",
                "02n": "images/few-clouds-night.jpg",
                "03d": "images/scattered-clouds-day.jpg",
                "03n": "images/scattered-clouds-night.jpg",
                "04d": "images/broken-clouds-day.jpg",
                "04n": "images/broken-clouds-night.jpg",
                "09d": "images/shower-rain-day.jpg",
                "09n": "images/shower-rain-night.jpg",
                "10d": "images/rain-day.jpg",
                "10n": "images/rain-night.jpg",
                "11d": "images/thunderstorm-day.jpg",
                "11n": "images/thunderstorm-night.jpg",
                "13d": "images/snow-day.jpg",
                "13n": "images/snow-night.jpg",
                "50d": "images/mist-day.jpg",
                "50n": "images/mist-night.jpg"
            };

            const backgroundUrl = weatherBackgrounds[iconCode] || weatherBackgrounds["01d"];

            // Create a new image to preload
            const img = new Image();
            img.src = backgroundUrl;

            img.onload = () => {
                // Add fade transition for background change
                document.body.classList.add("bg-transition");

                setTimeout(() => {
                    document.body.style.backgroundImage = `url('${backgroundUrl}')`;

                    setTimeout(() => {
                        document.body.classList.remove("bg-transition");
                    }, 500);
                }, 300);
            };
        }

        // Get forecast data
        async function getForecastData(lat, lon) {
            const url = `${FORECAST_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=${currentTempUnit}`;
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error("Failed to fetch forecast data");
            }

            return await response.json();
        }

        // Get air quality data
        async function getAirQuality(lat, lon) {
            const url = `${AQI_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}`;
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error("Failed to fetch air quality data");
            }

            return await response.json();
        }

        // Setup auto-refresh for weather data with improved mobile support
        function setupAutoRefresh(lat, lon, city) {
            // Clear existing intervals
            if (updateInterval) clearInterval(updateInterval);
            if (refreshCountdown) clearInterval(refreshCountdown);

            // Mark auto-refresh as active
            isAutoRefreshActive = true;

            // Set up refresh countdown
            countdown = 60;
            if (refreshTimer) {
                refreshTimer.textContent = countdown;
            }

            // More efficient countdown that checks for page visibility
            refreshCountdown = setInterval(() => {
                // Check if page is visible (mobile optimization)
                if (document.hidden || !isAutoRefreshActive) {
                    return;
                }

                countdown--;
                if (refreshTimer) {
                    refreshTimer.textContent = countdown;
                }

                if (countdown <= 0) {
                    countdown = 60;
                    if (refreshTimer) {
                        refreshTimer.textContent = countdown;
                    }
                    refreshWeatherData(lat, lon, city);
                }
            }, 1000);

            // Set up auto-refresh every 10 minutes (600000 ms)
            // Use setTimeout instead of setInterval for better mobile performance
            const scheduleNextUpdate = () => {
                if (updateInterval) clearTimeout(updateInterval);

                updateInterval = setTimeout(() => {
                    if (!document.hidden && isAutoRefreshActive) {
                        refreshWeatherData(lat, lon, city);
                        scheduleNextUpdate(); // Schedule next update
                    }
                }, 600000); // 10 minutes
            };

            scheduleNextUpdate();
        }

        // Handle page visibility changes for mobile optimization
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, pause auto-refresh
                if (refreshCountdown) {
                    clearInterval(refreshCountdown);
                }
            } else {
                // Page is visible again, resume auto-refresh if it was active
                if (isAutoRefreshActive && currentWeatherData) {
                    const city = cityInput.value.trim();
                    if (city) {
                        // Resume countdown
                        refreshCountdown = setInterval(() => {
                            if (document.hidden || !isAutoRefreshActive) {
                                return;
                            }

                            countdown--;
                            if (refreshTimer) {
                                refreshTimer.textContent = countdown;
                            }

                            if (countdown <= 0) {
                                countdown = 60;
                                if (refreshTimer) {
                                    refreshTimer.textContent = countdown;
                                }
                                refreshWeatherData(currentWeatherData.coord.lat, currentWeatherData.coord.lon, city);
                            }
                        }, 1000);
                    }
                }
            }
        });

        // Refresh weather data
        async function refreshWeatherData(lat, lon, city) {
            try {
                const url = `${WEATHER_BASE_URL}?q=${city}&appid=${WEATHER_API_KEY}&units=${currentTempUnit}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error("Failed to refresh weather data");
                }

                const data = await response.json();
                currentWeatherData = data;

                // Get additional data
                const [forecastData, aqiData, uvData] = await Promise.all([
                    getForecastData(lat, lon),
                    getAirQuality(lat, lon),
                    getUVIndex(lat, lon)
                ]);

                // Display all data
                displayWeather(data, uvData);
                displayForecast(forecastData);
                displayAirQuality(aqiData);

                // Update last updated text
                if (lastUpdated && refreshTimer) {
                    lastUpdated.innerHTML = `Last updated: Just now • Auto-refreshes in <span id="refreshTimer">${countdown}</span>s`;
                    // Re-get the refreshTimer element after innerHTML update
                    const newRefreshTimer = document.getElementById("refreshTimer");
                    if (newRefreshTimer) {
                        newRefreshTimer.textContent = countdown;
                    }
                }

                // Set background based on weather
                setWeatherBackground(data.weather[0].icon);

                // Add refresh animation
                weatherContainer.classList.add("refresh-pulse");
                setTimeout(() => {
                    weatherContainer.classList.remove("refresh-pulse");
                }, 1000);
            } catch (error) {
                console.error("Error refreshing data:", error);
            }
        }

        // Display weather data
        function displayWeather(data, uvData) {
            // Update location
            location_elem.textContent = `${data.name}, ${data.sys.country}`;

            // Unit dependent values
            const tempUnit = currentTempUnit === "metric" ? "°C" : "°F";
            const speedUnit = currentTempUnit === "metric" ? "km/h" : "mph";
            const speedMultiplier = currentTempUnit === "metric" ? 3.6 : 2.237; // Convert m/s to km/h or mph

            // Update temperature and details
            temperature.innerHTML = `${Math.round(data.main.temp)}<span class="temp-unit">${tempUnit}</span>`;
            minMaxTemp.textContent = `Min: ${Math.round(data.main.temp_min)}${tempUnit} | Max: ${Math.round(data.main.temp_max)}${tempUnit}`;
            feelsLike.textContent = `${Math.round(data.main.feels_like)}${tempUnit}`;
            humidity.textContent = `${data.main.humidity}%`;
            windSpeed.textContent = `${(data.wind.speed * speedMultiplier).toFixed(1)} ${speedUnit}`;

            // Wind direction
            const windDeg = data.wind.deg;
            windDirection.textContent = getWindDirection(windDeg);

            // Calculate and display dew point
            const dewPointValue = calculateDewPoint(data.main.temp, data.main.humidity);
            dewPoint.textContent = `${dewPointValue}${tempUnit}`;

            // Display UV Index if available
            if (uvData && uvData.value !== undefined) {
                const uvValue = uvData.value;
                let uvCategory = "";
                let uvColor = "";

                // Determine UV category and color
                if (uvValue < 3) {
                    uvCategory = "Low";
                    uvColor = "#3EA72D";
                } else if (uvValue < 6) {
                    uvCategory = "Moderate";
                    uvColor = "#FFF300";
                } else if (uvValue < 8) {
                    uvCategory = "High";
                    uvColor = "#F18B00";
                } else if (uvValue < 11) {
                    uvCategory = "Very High";
                    uvColor = "#E53210";
                } else {
                    uvCategory = "Extreme";
                    uvColor = "#B567A4";
                }

                uvIndex.innerHTML = `${uvValue.toFixed(1)} <span style="color:${uvColor};">(${uvCategory})</span>`;
            } else {
                uvIndex.textContent = "N/A";
            }

            // Additional details
            pressure.textContent = `${data.main.pressure} hPa`;
            visibility.textContent = `${(data.visibility / 1000).toFixed(1)} km`;
            cloudiness.textContent = `${data.clouds.all}%`;

            // Precipitation - this might be 0 if not available
            precipitation.textContent = data.rain ?
                `${data.rain['1h'] || 0} mm` :
                (data.snow ? `${data.snow['1h'] || 0} mm` : '0 mm');

            // Sunrise and sunset times
            const sunriseTime = new Date(data.sys.sunrise * 1000);
            const sunsetTime = new Date(data.sys.sunset * 1000);

            sunrise.textContent = formatTime(sunriseTime);
            sunset.textContent = formatTime(sunsetTime);

            // Update weather description
            weatherDescription.textContent = data.weather[0].description.charAt(0).toUpperCase() +
                data.weather[0].description.slice(1);

            // Update weather icon
            const iconCode = data.weather[0].icon;
            const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
            weatherIcon.innerHTML = `<img src="${iconUrl}" alt="${data.weather[0].description}" class="icon-pulse">`;

            // Update date and time
            updateDateTime();

            // Show weather container
            weatherContainer.style.display = "block";

            // Update temperature unit toggle button text
            toggleTempUnit.innerHTML = `<i class="fas fa-temperature-high"></i> ${currentTempUnit === "metric" ? "°C" : "°F"}`;
        }

        // Display forecast data
        function displayForecast(data) {
            // Clear previous forecast items
            forecastItems.innerHTML = '';

            // Get data for next 5 days (at 12:00)
            const forecastDays = {};
            const tempUnit = currentTempUnit === "metric" ? "°C" : "°F";

            // Process forecast data
            data.list.forEach(item => {
                const date = new Date(item.dt * 1000);
                const day = date.toLocaleDateString('en-US', { weekday: 'short' });

                // Check if we already have this day, and if the time is closer to noon (12:00)
                if (!forecastDays[day] ||
                    Math.abs(date.getHours() - 12) < Math.abs(forecastDays[day].date.getHours() - 12)) {
                    forecastDays[day] = {
                        date: date,
                        temp: Math.round(item.main.temp),
                        icon: item.weather[0].icon,
                        description: item.weather[0].description,
                        humidity: item.main.humidity,
                        wind: item.wind.speed
                    };
                }
            });

            // Create forecast items (limit to 5 days)
            Object.keys(forecastDays).slice(0, 5).forEach((day, index) => {
                const forecast = forecastDays[day];
                const iconUrl = `https://openweathermap.org/img/wn/${forecast.icon}.png`;

                const speedUnit = currentTempUnit === "metric" ? "km/h" : "mph";
                const speedMultiplier = currentTempUnit === "metric" ? 3.6 : 2.237;
                const windSpeed = (forecast.wind * speedMultiplier).toFixed(1);

                const forecastItem = document.createElement('div');
                forecastItem.className = 'forecast-item';
                forecastItem.style.animationDelay = `${index * 0.15}s`; // Staggered animation
                forecastItem.innerHTML = `
            <div class="forecast-day">${day}</div>
            <div class="forecast-icon">
                <img src="${iconUrl}" alt="${forecast.description}">
            </div>
            <div class="forecast-temp">${forecast.temp}${tempUnit}</div>
            <div class="forecast-details">
                <div><i class="fas fa-tint"></i> ${forecast.humidity}%</div>
                <div><i class="fas fa-wind"></i> ${windSpeed} ${speedUnit}</div>
            </div>
        `;

                forecastItems.appendChild(forecastItem);
            });
        }

        // Display air quality data
        function displayAirQuality(data) {
            if (!data || !data.list || !data.list[0]) {
                aqiContainer.style.display = 'none';
                return;
            }

            const aqiData = data.list[0];
            const aqiIndex = aqiData.main.aqi; // AQI index (1 to 5)

            // Set AQI information
            const aqiInfo = aqiDescriptions[aqiIndex];
            const aqiLeft = ((aqiIndex - 1) * 20) + 10; // Position marker (0-100%)

            aqiValue.textContent = `AQI: ${aqiIndex} (${['Excellent', 'Good', 'Moderate', 'Poor', 'Very Poor'][aqiIndex - 1]})`;
            aqiDescription.textContent = aqiInfo.text;
            aqiMarker.style.left = `${aqiLeft}%`;
            aqiMarker.style.backgroundColor = aqiInfo.color;

            // Show AQI container with animation
            aqiContainer.style.display = 'block';
            aqiContainer.classList.add("aqi-fade-in");
            setTimeout(() => {
                aqiContainer.classList.remove("aqi-fade-in");
            }, 1000);

            // Add additional pollutant data if available
            if (aqiData.components) {
                const pollutants = document.getElementById("pollutants");
                if (pollutants) {
                    pollutants.innerHTML = `
                <div class="pollutant-item"><span>CO:</span> ${aqiData.components.co.toFixed(1)} μg/m³</div>
                <div class="pollutant-item"><span>NO2:</span> ${aqiData.components.no2.toFixed(1)} μg/m³</div>
                <div class="pollutant-item"><span>O3:</span> ${aqiData.components.o3.toFixed(1)} μg/m³</div>
                <div class="pollutant-item"><span>PM2.5:</span> ${aqiData.components.pm2_5.toFixed(1)} μg/m³</div>
                <div class="pollutant-item"><span>PM10:</span> ${aqiData.components.pm10.toFixed(1)} μg/m³</div>
                <div class="pollutant-item"><span>SO2:</span> ${aqiData.components.so2.toFixed(1)} μg/m³</div>
            `;
                }
            }
        }

        // Format time to 12-hour format
        function formatTime(date) {
            let hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';

            hours = hours % 12;
            hours = hours ? hours : 12; // Convert 0 to 12

            return `${hours}:${minutes} ${ampm}`;
        }

        // Get wind direction from degrees
        function getWindDirection(degrees) {
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            const index = Math.round(degrees / 22.5) % 16;
            return directions[index];
        }

        // Show loading animation
        function showLoading() {
            loading.style.display = "block";
            weatherContainer.style.display = "none";
        }

        // Hide loading animation
        function hideLoading() {
            loading.style.display = "none";
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorContainer.style.display = "block";

            // Add error animation
            errorContainer.classList.add("error-shake");
            setTimeout(() => {
                errorContainer.classList.remove("error-shake");
            }, 500);
        }

        // Hide error message
        function hideError() {
            errorContainer.style.display = "none";
        }

        // Initial date and time update
        updateDateTime();

        // Try to get weather for user's location on page load with better mobile support
        window.addEventListener('load', () => {
            // Check if geolocation is available
            if (navigator.geolocation) {
                // Use better options for mobile devices
                const options = {
                    enableHighAccuracy: false, // Don't use GPS for faster response
                    timeout: 10000, // 10 second timeout
                    maximumAge: 300000 // Accept cached position up to 5 minutes old
                };

                navigator.geolocation.getCurrentPosition(
                    // Success callback
                    async (position) => {
                        try {
                            showLoading();

                            const lat = position.coords.latitude;
                            const lon = position.coords.longitude;

                            // Get city name from coordinates
                            const geoUrl = `https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${WEATHER_API_KEY}`;
                            const geoResponse = await fetch(geoUrl);

                            if (!geoResponse.ok) {
                                throw new Error("Failed to get location name");
                            }

                            const geoData = await geoResponse.json();

                            if (geoData && geoData.length > 0) {
                                const cityName = geoData[0].name;
                                cityInput.value = cityName;

                                // Get weather for the detected city
                                await getWeather();
                            }
                        } catch (error) {
                            console.error("Error getting location weather:", error);
                            hideLoading();
                        }
                    },
                    // Error callback
                    (error) => {
                        console.error("Geolocation error:", error);
                    },
                    options
                );
            }
        });

        // Clean up intervals when page is about to unload
        window.addEventListener('beforeunload', () => {
            isAutoRefreshActive = false;
            if (updateInterval) clearTimeout(updateInterval);
            if (refreshCountdown) clearInterval(refreshCountdown);
        });

        // Update time every minute
        setInterval(updateDateTime, 60000);
    </script>
    <script src="bg.js"></script>
</body>

</html>